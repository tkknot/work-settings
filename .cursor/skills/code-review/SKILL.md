---
name: code-review
description: コードレビューの観点・手順・出力フォーマットを定義し、品質の高いレビューを実施するためのスキル
---

# コードレビュースキル

セキュリティ・品質・パフォーマンスの観点から、実践的で建設的なコードレビューを行うためのスキルです。

## レビュー準備

### 変更内容の取得

```bash
# 未コミットの変更
git diff

# ステージング済みの変更
git diff --staged

# 特定ブランチとの差分
git diff origin/main...HEAD

# 変更ファイル一覧
git diff --name-status origin/main...HEAD

# PRの差分（gh CLI）
PAGER=cat gh pr diff
```

### 変更ファイルの全体確認

```bash
# 変更したメソッドの全体を確認（差分だけでなく）
git show HEAD:<file-path>
```

---

## レビュー観点

### 🔐 セキュリティ (Security)

| チェック項目 | 確認内容 |
|-------------|---------|
| 入力検証 | ユーザー入力のバリデーション・サニタイズ |
| 認証・認可 | 適切なアクセス制御が実装されているか |
| 機密情報 | APIキー・パスワードがハードコードされていないか |
| 脆弱性 | SQLインジェクション、XSS、CSRF等の対策 |
| 依存関係 | 脆弱な依存パッケージを使用していないか |

### 📝 コード品質 (Code Quality)

| チェック項目 | 確認内容 |
|-------------|---------|
| 命名規則 | 明確で一貫性のある命名か |
| 抽象化 | 適切なレベルで抽象化されているか |
| DRY原則 | 重複コードがないか |
| SOLID原則 | 単一責任、開放閉鎖等に従っているか |
| コメント | 必要十分なドキュメントがあるか |

### ⚡ パフォーマンス (Performance)

| チェック項目 | 確認内容 |
|-------------|---------|
| ループ効率 | 不必要なループ・クエリがないか |
| N+1問題 | DBアクセスのN+1問題がないか |
| メモリ | メモリリークの可能性がないか |
| キャッシュ | 適切なキャッシング戦略か |
| 複雑度 | アルゴリズムの計算量は適切か |

### ✅ ベストプラクティス (Best Practices)

| チェック項目 | 確認内容 |
|-------------|---------|
| 言語規約 | 言語・フレームワーク固有のパターンに従っているか |
| エラー処理 | 適切なエラーハンドリングがあるか |
| テスト | テストの追加・更新が必要か |
| 一貫性 | 既存のコードスタイルと一貫しているか |
| 可読性 | 他の開発者が理解しやすいか |

---

## 重要度分類

| レベル | 意味 | 対応 |
|--------|------|------|
| 🔴 **Critical** | セキュリティ問題、データ損失のリスク | 即時対応必須 |
| 🟠 **Major** | バグの可能性、設計上の問題 | マージ前に対応推奨 |
| 🟡 **Minor** | リファクタリング提案、軽微な改善 | 可能なら対応 |
| 💭 **Suggestion** | 代替案の提示、議論の余地あり | 検討のみ |

---

## 出力フォーマット

```markdown
## 📋 コードレビュー結果

### 概要
- 変更ファイル数: X
- 総合評価: ⭐⭐⭐⭐☆
- レビュー観点: セキュリティ / 品質 / パフォーマンス

### 🔴 Critical（即時対応が必要）
- **[ファイル名:行番号]** 問題の説明
  - 理由: なぜ問題か
  - 修正案: 具体的なコード例

### 🟠 Major（対応推奨）
- **[ファイル名:行番号]** 問題の説明
  - 修正案: ...

### 🟡 Minor（改善提案）
- **[ファイル名:行番号]** 改善点
  - 提案: ...

### ✅ 良い点
- 評価できるポイント
- 良い設計判断
```

---

## 建設的なフィードバックの書き方

### ❌ 悪い例
```
このコードは間違っている
```

### ✅ 良い例
```
ここでnullチェックがないため、userがnullの場合にTypeErrorが発生する
可能性があります。

修正案:
const name = user?.name ?? 'Unknown';
```

### フィードバックのポイント

1. **問題を具体的に説明** - 何が問題か明確に
2. **理由を述べる** - なぜ問題なのか
3. **修正案を提示** - どう直すべきか
4. **質問形式も有効** - 「〜の場合はどうなりますか？」

---

## レビューのベストプラクティス

1. **コードを理解してからレビュー** - 変更の意図を把握
2. **変更したメソッド全体を確認** - 差分だけでなく文脈も
3. **テストの有無を確認** - テストがなければ指摘
4. **良い点も指摘** - モチベーション維持
5. **議論はオープンに** - 正解が複数ある場合は議論
6. **優先度を明確に** - すべて同じ重要度にしない
